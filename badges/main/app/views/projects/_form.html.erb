<%= simple_form_for(@project) do |f| %>
  <%= render 'shared/errors', resource: @project if @project.errors.any? %>

  <div class="grid grid-cols-1 md:grid-cols-[3fr_1fr] gap-6 p-3 mb-6 items-start">

    <!-- LEFT SIDE (3/4) -->
    <div>
      <!-- Project Name + Hidden -->
      <div class="grid grid-cols-1 md:grid-cols-[3fr_1fr] gap-4 mb-6">
        <div>
          <%= f.input :name,
                      label: "Project Name",
                      as: :text,
                      required: true,
                      input_html: {
                        autofocus: true,
                        rows: 1,
                        class: "w-full rounded-md border-gray-300 shadow-sm
                        focus:border-blue-500 focus:ring focus:ring-blue-200"
                      } %>
        </div>

        <div class="flex items-center">
          <%= f.input :inactive,
                      as: :boolean,
                      label: "Hidden?",
                      input_html: {
                        class: "mr-2 rounded focus:ring-blue-500 text-blue-600"
                      } %>
        </div>
      </div>

      <!-- Sectors -->
      <div class="form-group space-y-4">
        <div class="font-semibold text-gray-700">
          Sectors served
        </div>
        <div class="rounded-lg border border-gray-200 bg-gray-50 p-4 mb-4 shadow-sm">
          <div class="flex flex-wrap items-center gap-4 p-3">
            <%= f.simple_fields_for :sectorable_items do |sfi| %>
              <%= render "sectorable_item_fields", f: sfi %>
            <% end %>

             <%= link_to_add_association "â• Add Sector",
                                      f,
                                      :sectorable_items,
                                      render_options: {
                                        locals: {
                                          collection: Sector.published.where.not(name: f.object.sector_list)
                                        }
                                      },
                                    class: "btn btn-secondary-outline" %>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE (1/4) -->
    <div class="flex justify-center text-center md:justify-start">
      <div class="flex flex-col items-center gap-4" style="flex: 0 0 25%;">
        <!-- LOGO -->
        <%= f.fields_for :logo_image do |img| %>
          <div class="w-full flex flex-col text-center items-center gap-4">
            <%= render "shared/form_image_field",
                       f: img,
                       resource: img.object,
                       label: "Avatar" %>
          </div>
        <% end %>
      </div>
    </div>

  </div>


  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="flex flex-col">
      <%= f.input :agency_type,
                  label: "Agency Type",
                  as: :select,
                  required: true,
                  collection: [
                    "501c3/nonprofit",
                    "For-profit",
                    "Government agency",
                    "Other (please specify below)"
                  ],
                  selected: f.object.agency_type,
                  input_html: {
                    value: f.object.agency_type,
                    class: "rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  } %>
    </div>
    <%= f.input :agency_type_other,
                label: "Agency Type Other",
                hint: "Please specify if 'Other' selected",
                input_html: {
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"
                } %>
    <%= f.association :windows_type,
                      label: "Windows Type",
                      include_blank: true,
                      required: false,
                      input_html: {
                        class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"
                      } %>

    <%= f.input :project_status_id,
                as: :select,
                collection: @project_statuses,
                include_blank: true,
                label: "Status",
                required: true,
                input_html: {
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"
                } %>
  </div>

  <!-- WINDOWS / STATUS / START / END -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <%= f.input :start_date,
                label: "Affiliation start date",
                as: :string,
                input_html: {
                  type: 'date',
                  value: f.object.start_date&.strftime('%Y-%m-%d'),
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                } %>

    <%= f.input :end_date,
                label: "Affiliation end date",
                as: :string,
                input_html: {
                  type: 'date',
                  value: f.object.end_date&.strftime('%Y-%m-%d'),
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                } %>
    <%= f.input :website_url,
                label: "Website URL",
                as: :string,
                input_html: {
                  class: "rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                } %>
    <%= f.input :internal_id,
                label: "Internal Project ID",
                input_html: {
                  class: "rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                } %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <%= f.input :description,
                as: :text,
                label: "Description",
                input_html: {
                  rows: 4,
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-200"
                } %>
    <%= f.input :mission_vision_values,
                label: "Mission / Vision / Values",
                as: :text,
                input_html: {
                  rows: 4,
                  class: "rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"
                } %>
  </div>

  <div class="mb-6">
    <%= f.input :notes,
                as: :text,
                label: "Internal Notes",
                input_html: {
                  rows: 3,
                  class: "rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-200"
                } %>
  </div>

  <div class="form-group space-y-4">
    <div class="font-semibold text-gray-700">
      Addresses
    </div>
    <div class="rounded-lg border border-gray-200 bg-gray-50 p-4 mb-4 shadow-sm">
      <div class="flex flex-wrap items-center gap-4 p-3">
        <%= f.simple_fields_for :addresses do |sfi| %>
          <%= render "address_fields", f: sfi %>
        <% end %>
      </div>
      <%= link_to_add_association "â• Add Address",
                                  f,
                                  :addresses,
                                  render_options: {
                                    locals: {
                                      collection: Sector.published.where.not(name: f.object.sector_list)
                                    }
                                  },
                                  class: "btn btn-secondary-outline" %>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="flex justify-end gap-3">
    <% if  @project.persisted? && current_user.super_user? %>
      <%= link_to "Delete", @project, class: "btn btn-danger-outline",
                  method: :delete, data: { confirm: "Are you sure?" } %>
    <% end %>
    <%= link_to "Cancel", projects_path, class: "btn btn-utility-outline" %>
    <%= f.button :submit, class: "btn btn-primary" %>
  </div>
<% end %>
