<%= tag.div id: dom_id(event, :card), class: "
    relative bg-white border border-gray-200 rounded-xl shadow hover:shadow-md
    transition p-4 flex flex-col
  " do %>
  <!-- Event Title -->
  <h3 class="text-lg font-semibold text-gray-900 mb-2">
    <div class="flex items-center space-x-2">
      <!-- Bookmark icon -->
      <%= render "bookmarks/editable_bookmark_icon", resource: event %>
      <!-- Title link -->
      <%= link_to "#{event.title}#{" [HIDDEN]" if current_user.super_user? && !event.publicly_visible}",
      event_path(event),
      class: "text-gray-900 hover:underline font-medium" %>
      <% if event.featured? %>
        <span class="inline-flex items-center gap-1 ms-2 px-2 py-0.5 rounded-full text-sm font-medium
        bg-yellow-100 text-yellow-800 whitespace-nowrap">
          ðŸŒŸ Featured
        </span>
      <% end %>
    </div>
  </h3>

  <% if event.event_registrations.exists?(registrant_id: current_user.id) %>
    <span
      class="
        absolute top-2 right-2 text-xs bg-green-100 text-green-700 px-2 py-0.5
        rounded-full
      "
    >
      Registered
    </span>
  <% end %>

  <!-- Dates -->
  <p class="text-sm text-gray-600 mb-1">
    <span class="font-medium">Start:</span>
    <%= event.start_date&.strftime("%B %d, %Y") %>
  </p>

  <p class="text-sm text-gray-600 mb-3">
    <span class="font-medium">End:</span>
    <%= event.end_date&.strftime("%B %d, %Y") %>
  </p>

  <div class="mt-3 flex gap-2">
    <!-- Admin Edit -->
    <% if current_user.super_user %>
      <div class="mt-2">
        <%= link_to "Edit", edit_event_path(event), class: "btn btn-secondary-outline" %>
      </div>
    <% end %>

    <% if event.event_registrations.exists?(registrant_id: current_user.id) %>
      <div class="mt-2 ml-auto">
        <%= button_to "De-register",
        event_registrant_registration_path(event_id: event.id),
        class: "btn btn-secondary-outline",
        method: :delete,
        data: {
          turbo_confirm: "Are you sure you want to de-register?",
        } %>
      </div>
    <% elsif event.registerable? %>
      <div class="mt-2 ml-auto">
        <%= button_to "Register",
        event_registrant_registration_path(event_id: event),
        class: "btn btn-primary-outline" %>
      </div>
    <% else %>
      <div class="mt-2 ml-auto">
        <span class="text-sm text-gray-500 italic">Registration closed</span>
      </div>
    <% end %>
  </div>

 <!-- Calendar -->
<% if event.event_registrations.exists?(registrant_id: current_user.id) %>
  <% start_time = event.start_date.strftime("%Y%m%dT%H%M%SZ") %>
  <% end_time   = event.end_date.strftime("%Y%m%dT%H%M%SZ") %>
  <% title_encoded = ERB::Util.url_encode(event.title) %>
  <% desc_encoded  = ERB::Util.url_encode(event.description || "") %>

  
    <div class="text-sm font-semibold text-gray-600 mb-2">Add to calendar:</div>
    <div class="text-xs flex flex-wrap gap-2">
      <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=<%= title_encoded %>&dates=<%= start_time %>/<%= end_time %>&details=<%= desc_encoded %>" 
         class="text-blue-600 hover:text-blue-800 hover:underline">Google</a>
      <span class="text-gray-300">â€¢</span>
      <a href="data:text/calendar;charset=utf8,BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:<%= event.title %>
DTSTART:<%= start_time %>
DTEND:<%= end_time %>
DESCRIPTION:<%= event.description %>
END:VEVENT
END:VCALENDAR" 
         download="<%= event.title.parameterize %>.ics" 
         class="text-blue-600 hover:text-blue-800 hover:underline">Apple</a>
      <span class="text-gray-300">â€¢</span>
      <a href="https://outlook.live.com/owa/?rru=addevent&startdt=<%= start_time %>&enddt=<%= end_time %>&subject=<%= title_encoded %>&body=<%= desc_encoded %>" 
         class="text-blue-600 hover:text-blue-800 hover:underline">Outlook</a>
      <span class="text-gray-300">â€¢</span>
      <a href="https://outlook.office.com/owa/?rru=addevent&startdt=<%= start_time %>&enddt=<%= end_time %>&subject=<%= title_encoded %>&body=<%= desc_encoded %>" 
         class="text-blue-600 hover:text-blue-800 hover:underline">Office 365</a>
      <span class="text-gray-300">â€¢</span>
      <a href="https://calendar.yahoo.com/?v=60&title=<%= title_encoded %>&st=<%= start_time %>&et=<%= end_time %>&desc=<%= desc_encoded %>" 
         class="text-blue-600 hover:text-blue-800 hover:underline">Yahoo</a>
    </div>

<% end %>
<% end %>
