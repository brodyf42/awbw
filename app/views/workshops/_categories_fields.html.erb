<% metadata.each do |metadatum, categories| %>
  <div class="categories-fields-wrapper border border-gray-300 rounded-lg overflow-hidden flex-1 min-w-[200px] max-w-md">
    <!-- Header -->
    <div class="categories-header flex justify-between items-center bg-white px-4 py-2 w-full cursor-pointer"
         data-action="click->dropdown#toggle">
      <label class="mb-0 font-medium text-gray-700"><%= metadatum.display_name %></label>
      <%= image_tag(
            "collapse-arrow.png",
            class: "arrow-down w-4 h-4 transition-transform duration-300",
            "data-dropdown-target" => "icon"
          ) %>
    </div>

    <!-- Collapsible content -->
    <div class="categories-fields mt-2 hidden" data-dropdown-target="content">
      <% metadatum.categories.each do |category| %>
        <div class="form-check flex items-center gap-2 mb-1 px-4">
          <%= check_box_tag "categories[#{category.id}]",
                            category.id,
                            params.dig(:categories, category.id.to_s).to_s == category.id.to_s,
                            id: "category_#{category.id}",
                            class: "form-check-input category-checkbox" %>
          <%= label_tag "category_#{category.id}", category.name, class: "form-check-label text-sm text-gray-700" %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
